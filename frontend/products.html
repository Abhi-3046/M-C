<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - M&C E-Commerce</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">M&C Store</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="products.html">Products</a></li>
                <li class="cart-badge">
                    <a href="cart.html">ðŸ›’ Cart</a>
                    <span class="badge" style="display: none;">0</span>
                </li>
                <li class="auth-links">
                    <a href="login.html">Login</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container section">
        <h1 class="text-center mb-2">Our Products</h1>

        <!-- Search and Filters -->
        <div class="search-filter-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search products...">
            </div>
            <select id="categoryFilter" class="filter-select">
                <option value="">All Categories</option>
                <option value="1">Smartphones</option>
                <option value="2">Laptops</option>
                <option value="3">Accessories</option>
            </select>
            <select id="brandFilter" class="filter-select">
                <option value="">All Brands</option>
                <option value="Samsung">Samsung</option>
                <option value="Google">Google</option>
                <option value="Honor">Honor</option>
                <option value="OnePlus">OnePlus</option>
                <option value="Vivo">Vivo</option>
                <option value="iQOO">iQOO</option>
            </select>
            <select id="sortFilter" class="filter-select">
                <option value="">Sort By</option>
                <option value="price_low">Price: Low to High</option>
                <option value="price_high">Price: High to Low</option>
                <option value="newest">Newest First</option>
            </select>
        </div>

        <!-- Products Grid -->
        <div id="productsGrid" class="products-grid">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex-center" style="margin-top: 2rem; gap: 1rem;"></div>
    </div>

    <footer
        style="background: rgba(21, 25, 50, 0.8); padding: 3rem 0; margin-top: 4rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
        <div class="container text-center">
            <div class="logo" style="margin-bottom: 1rem; font-size: 2rem;">M&C Store</div>
            <p style="margin-bottom: 1rem;">Your trusted partner for premium devices</p>
            <p style="color: var(--text-secondary); font-size: 0.875rem;">Â© 2026 M&C E-Commerce. All rights reserved.
            </p>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script>
        let currentPage = 1;
        let allProducts = [];

        async function loadProducts() {
            const container = document.getElementById('productsGrid');
            showLoading(container);

            try {
                const searchQuery = document.getElementById('searchInput').value;
                const category = document.getElementById('categoryFilter').value;
                const brand = document.getElementById('brandFilter').value;

                let endpoint = `/products?page=${currentPage}&limit=12`;
                if (searchQuery) endpoint += `&search=${encodeURIComponent(searchQuery)}`;
                if (category) endpoint += `&category_id=${category}`;
                if (brand) endpoint += `&brand=${encodeURIComponent(brand)}`;

                const data = await apiCall(endpoint);
                allProducts = data.products || [];

                // Apply sorting
                const sortBy = document.getElementById('sortFilter').value;
                if (sortBy === 'price_low') {
                    allProducts.sort((a, b) => (a.discount_price || a.price) - (b.discount_price || b.price));
                } else if (sortBy === 'price_high') {
                    allProducts.sort((a, b) => (b.discount_price || b.price) - (a.discount_price || a.price));
                }

                if (allProducts.length > 0) {
                    container.innerHTML = allProducts.map(product => createProductCard(product)).join('');
                } else {
                    container.innerHTML = '<p class="text-center" style="grid-column: 1/-1;">No products found</p>';
                }
            } catch (error) {
                container.innerHTML = '<p class="text-center" style="grid-column: 1/-1; color: var(--error);">Failed to load products</p>';
            }
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', debounce(loadProducts, 500));
        document.getElementById('categoryFilter').addEventListener('change', loadProducts);
        document.getElementById('brandFilter').addEventListener('change', loadProducts);
        document.getElementById('sortFilter').addEventListener('change', () => {
            const container = document.getElementById('productsGrid');
            const sortBy = document.getElementById('sortFilter').value;

            if (sortBy === 'price_low') {
                allProducts.sort((a, b) => (a.discount_price || a.price) - (b.discount_price || b.price));
            } else if (sortBy === 'price_high') {
                allProducts.sort((a, b) => (b.discount_price || b.price) - (a.discount_price || a.price));
            }

            container.innerHTML = allProducts.map(product => createProductCard(product)).join('');
        });

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Load products on page load
        loadProducts();

        // Check URL params for category
        const urlParams = new URLSearchParams(window.location.search);
        const categoryParam = urlParams.get('category');
        if (categoryParam === 'smartphones') {
            document.getElementById('categoryFilter').value = '1';
            loadProducts();
        } else if (categoryParam === 'laptops') {
            document.getElementById('categoryFilter').value = '2';
            loadProducts();
        }
    </script>
</body>

</html>