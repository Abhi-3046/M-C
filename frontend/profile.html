<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - M&C E-Commerce</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">M&C Store</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="products.html">Products</a></li>
                <li class="cart-badge">
                    <a href="cart.html">ðŸ›’ Cart</a>
                    <span class="badge" style="display: none;">0</span>
                </li>
                <li>
                    <a href="#" onclick="logout(); return false;">Logout</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container section">
        <h1 class="text-center mb-2">My Profile</h1>

        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; align-items: start;">
            <!-- User Info -->
            <div class="glass-card">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div
                        style="width: 100px; height: 100px; border-radius: 50%; background: var(--primary-gradient); margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                        ðŸ‘¤
                    </div>
                    <h2 id="userName"></h2>
                    <p id="userEmail" style="color: var(--text-secondary);"></p>
                </div>

                <div style="padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <p style="margin-bottom: 0.5rem;"><strong>Phone:</strong> <span id="userPhone"></span></p>
                    <p><strong>Address:</strong></p>
                    <p id="userAddress" style="color: var(--text-secondary);"></p>
                </div>
            </div>

            <!-- Orders -->
            <div class="glass-card">
                <h2 style="margin-bottom: 1.5rem;">My Orders</h2>
                <div id="ordersContainer"></div>
            </div>
        </div>
    </div>

    <footer
        style="background: rgba(21, 25, 50, 0.8); padding: 3rem 0; margin-top: 4rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
        <div class="container text-center">
            <div class="logo" style="margin-bottom: 1rem; font-size: 2rem;">M&C Store</div>
            <p style="margin-bottom: 1rem;">Your trusted partner for premium devices</p>
            <p style="color: var(--text-secondary); font-size: 0.875rem;">Â© 2026 M&C E-Commerce. All rights reserved.
            </p>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script>
        // Redirect if not logged in
        if (!isLoggedIn()) {
            window.location.href = 'login.html';
        }

        async function loadUserProfile() {
            try {
                const user = await apiCall('/auth/me', 'GET', null, true);

                document.getElementById('userName').textContent = user.full_name;
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userPhone').textContent = user.phone || 'Not provided';
                document.getElementById('userAddress').textContent = user.address || 'Not provided';
            } catch (error) {
                console.error('Failed to load profile:', error);
            }
        }

        async function loadOrders() {
            const container = document.getElementById('ordersContainer');

            try {
                const orders = await apiCall('/orders', 'GET', null, true);

                if (!orders || orders.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 2rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ“¦</div>
                            <p>No orders yet</p>
                            <button class="btn btn-primary" onclick="window.location.href='products.html'" style="margin-top: 1rem;">
                                Start Shopping
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = orders.map(order => {
                    const statusColors = {
                        pending: 'var(--warning)',
                        processing: 'var(--accent-cyan)',
                        shipped: 'var(--accent-purple)',
                        delivered: 'var(--success)',
                        cancelled: 'var(--error)'
                    };

                    return `
                        <div class="card" style="margin-bottom: 1rem; padding: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                <div>
                                    <h3>Order #${order.id}</h3>
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">
                                        ${new Date(order.created_at).toLocaleDateString('en-IN', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    })}
                                    </p>
                                </div>
                                <div style="text-align: right;">
                                    <div style="display: inline-block; padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; border: 1px solid ${statusColors[order.status]}; color: ${statusColors[order.status]}; font-weight: 600; text-transform: uppercase; font-size: 0.875rem;">
                                        ${order.status}
                                    </div>
                                    <p style="font-size: 1.5rem; font-weight: 700; margin-top: 0.5rem; color: var(--accent-cyan);">
                                        ${formatPrice(order.total_amount)}
                                    </p>
                                </div>
                            </div>
                            <div style="padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                                <p style="margin-bottom: 0.5rem;"><strong>Payment:</strong> ${order.payment_method.toUpperCase()}</p>
                                <p style="margin-bottom: 0.5rem;"><strong>Payment Status:</strong> 
                                    <span style="color: ${order.payment_status === 'completed' ? 'var(--success)' : 'var(--warning)'}">
                                        ${order.payment_status}
                                    </span>
                                </p>
                                <button class="btn btn-outline" onclick="viewOrderDetails(${order.id})" style="margin-top: 1rem; padding: 0.5rem 1rem; font-size: 0.875rem;">
                                    View Details
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                container.innerHTML = '<p style="color: var(--error);">Failed to load orders</p>';
            }
        }

        async function viewOrderDetails(orderId) {
            try {
                const order = await apiCall(`/orders/${orderId}`, 'GET', null, true);

                let itemsHTML = '';
                if (order.items && order.items.length > 0) {
                    itemsHTML = order.items.map(item => `
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <img src="${item.image_url}" alt="${item.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 0.5rem;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">${item.name}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">Qty: ${item.quantity}</div>
                            </div>
                            <div style="font-weight: 700; color: var(--accent-cyan);">
                                ${formatPrice(item.price * item.quantity)}
                            </div>
                        </div>
                    `).join('');
                }

                // Show modal with order details
                const modal = document.createElement('div');
                modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 2rem;';
                modal.innerHTML = `
                    <div class="glass-card" style="max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h2>Order #${order.id} Details</h2>
                            <button onclick="this.closest('div[style*=fixed]').remove()" style="background: transparent; border: none; color: white; font-size: 2rem; cursor: pointer;">&times;</button>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="margin-bottom: 1rem;">Items</h3>
                            ${itemsHTML}
                        </div>

                        <div style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 0.5rem;">
                            <h3 style="margin-bottom: 0.5rem;">Shipping Address</h3>
                            <p style="white-space: pre-line; color: var(--text-secondary);">${order.shipping_address}</p>
                        </div>

                        <div style="padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <div style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: 700;">
                                <span>Total</span>
                                <span style="color: var(--accent-cyan);">${formatPrice(order.total_amount)}</span>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } catch (error) {
                showNotification('Failed to load order details', 'error');
            }
        }

        loadUserProfile();
        loadOrders();

        // Check for order success message
        const params = new URLSearchParams(window.location.search);
        if (params.get('order')) {
            showNotification('Order placed successfully! Order #' + params.get('order'), 'success');
        }
    </script>

    <style>
        @media (max-width: 768px) {
            .container>div {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</body>

</html>